
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat Assistant</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM CDNs -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX transformation in the browser (for development/single file) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- React Markdown CDN -->
    <script src="https://unpkg.com/react-markdown/react-markdown.min.js"></script>

    <style>
        /* Custom scrollbar style */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #374151; /* gray-700 */
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #10B981; /* green-500 */
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #059669; /* green-600 */
        }
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Tailwind Typography plugin classes for Markdown rendering */
        /* These styles are typically provided by @tailwindcss/typography plugin.
           Since we're using CDN, we'll manually add some basic ones for markdown. */
        .prose {
            color: inherit; /* Inherit text color */
        }
        .prose strong {
            color: inherit; /* Inherit strong text color */
        }
        .prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 {
            color: inherit;
            margin-top: 1em;
            margin-bottom: 0.5em;
            font-weight: bold;
        }
        .prose p {
            margin-bottom: 0.5em; /* Adjust paragraph spacing */
        }
        .prose ul, .prose ol {
            margin-left: 1.25em;
            margin-bottom: 0.5em;
            list-style-type: disc; /* Default list style */
        }
        .prose ol {
            list-style-type: decimal;
        }
        .prose li {
            margin-bottom: 0.25em;
        }
        .prose code {
            background-color: rgba(100, 100, 100, 0.2);
            padding: 0.2em 0.4em;
            border-radius: 0.3em;
            font-size: 0.85em;
            color: #fff; /* Ensure code text is visible */
        }
        .prose pre {
            background-color: #1a202c; /* Darker background for code blocks */
            padding: 1em;
            border-radius: 0.5em;
            overflow-x: auto;
            color: #fff;
        }
        .prose pre code {
            background-color: transparent; /* No extra background for inline code in pre */
            padding: 0;
            border-radius: 0;
            font-size: inherit;
            color: inherit;
        }
    </style>
</head>
<body class="bg-gray-900">
    <div id="root"></div>

    <script type="text/babel">
        // React components and logic go here
        const { useState, useEffect, useRef } = React;
        const ReactMarkdown = window.ReactMarkdown; // Access ReactMarkdown from global scope

        // Main App component
        const App = () => {
            // State variables
            const [terminalOutput, setTerminalOutput] = useState([]); // Stores lines of chat output
            const [commandInput, setCommandInput] = useState(''); // Stores the current message being typed
            const [isAskingAI, setIsAskingAI] = useState(false); // Flag to indicate if AI is being queried
            const terminalRef = useRef(null); // Ref for scrolling the chat output

            // Initial welcome messages on component mount
            useEffect(() => {
                addLineToTerminal(`Hello! I'm your AI assistant.`, 'system');
                addLineToTerminal('Type your question below and press Enter to chat with me.', 'system');
                addLineToTerminal('You can also type \'clear\' to clear our conversation history.', 'system');
            }, []); // Empty dependency array means this runs once on mount

            // Effect to scroll to the bottom of the chat output
            useEffect(() => {
                if (terminalRef.current) {
                    terminalRef.current.scrollTop = terminalRef.current.scrollHeight;
                }
            }, [terminalOutput]); // Re-run when terminalOutput changes

            // Function to add a line to the chat output
            const addLineToTerminal = (line, type = 'output') => {
                setTerminalOutput(prev => [...prev, { text: line, type }]);
            };

            // Function to clear the chat output
            const clearTerminal = () => {
                setTerminalOutput([]);
                // Re-add initial messages after clearing
                addLineToTerminal(`Hello! I'm your AI assistant.`, 'system');
                addLineToTerminal('Type your question below and press Enter to chat with me.', 'system');
                addLineToTerminal('You can also type \'clear\' to clear our conversation history.', 'system');
            };

            // Command/Query execution logic
            const executeCommand = async (command) => {
                const trimmedCommand = command.trim();
                if (!trimmedCommand) return; // Do nothing if command is empty

                // Add user's input to the chat history
                addLineToTerminal(trimmedCommand, 'user-input');

                // Check for specific commands first
                if (trimmedCommand.toLowerCase() === 'clear') {
                    clearTerminal();
                    return; // Exit after clearing
                }

                // If not 'clear', treat all other input as an AI query
                const aiQuery = trimmedCommand;
                addLineToTerminal(`Thinking...`, 'thinking'); // Display a temporary thinking message
                setIsAskingAI(true); // Set flag to show loading

                try {
                    // Gemini API call
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: aiQuery }] });

                    const payload = { contents: chatHistory };
                    // IMPORTANT: Replace "YOUR_GEMINI_API_KEY_HERE" with your actual API key
                    const apiKey = "AIzaSyDiVKPShRyg9Llydvi7q-LZTb3q_gXx78k"; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();

                    // Remove the "Thinking..." message before adding the actual AI response
                    setTerminalOutput(prev => prev.filter(line => line.type !== 'thinking'));

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const aiResponse = result.candidates[0].content.parts[0].text;
                        addLineToTerminal(aiResponse, 'ai'); // Store raw Markdown for AI response
                    } else {
                        addLineToTerminal('Error: Could not get a valid response from the AI model.', 'error');
                        console.error('AI API response structure unexpected:', result);
                    }
                } catch (error) {
                    // Remove the "Thinking..." message on error
                    setTerminalOutput(prev => prev.filter(line => line.type !== 'thinking'));
                    addLineToTerminal(`Error interacting with AI: ${error.message}`, 'error');
                    console.error('AI API call failed:', error);
                } finally {
                    setIsAskingAI(false); // Reset loading flag
                }
            };

            // Handle message input submission
            const handleCommandSubmit = (e) => {
                e.preventDefault();
                executeCommand(commandInput);
                setCommandInput(''); // Clear input after submission
            };

            return (
                <div className="min-h-screen bg-gray-900 text-gray-100 font-mono flex items-center justify-center p-4">
                    <div className="bg-gray-800 p-6 rounded-lg shadow-lg w-full max-w-4xl h-[80vh] flex flex-col border border-gray-700">
                        {/* Chat Header */}
                        <div className="flex-none text-lg font-bold text-gray-300 mb-4 border-b border-gray-700 pb-3">
                            AI Chat Assistant
                        </div>

                        {/* Chat Output Area */}
                        <div ref={terminalRef} className="flex-grow overflow-y-auto pr-2 custom-scrollbar space-y-4">
                            {terminalOutput.map((line, index) => (
                                <div key={index} className={`text-sm p-3 rounded-lg ${
                                    line.type === 'user-input' ? 'bg-blue-700 text-blue-100 self-end ml-auto max-w-[80%]' :
                                    line.type === 'ai' ? 'bg-gray-700 text-gray-100 self-start mr-auto max-w-[80%]' :
                                    line.type === 'error' ? 'bg-red-700 text-red-100' :
                                    line.type === 'thinking' ? 'text-yellow-400 animate-pulse text-center' :
                                    'text-gray-400' // System messages
                                }`}>
                                    {line.type === 'ai' ? (
                                        // Render AI responses with Markdown
                                        <ReactMarkdown children={line.text} className="prose prose-invert max-w-none" />
                                    ) : (
                                        // Render other messages as plain text
                                        line.text
                                    )}
                                </div>
                            ))}
                        </div>

                        {/* Message Input Area */}
                        <form onSubmit={handleCommandSubmit} className="flex-none mt-4 flex items-center">
                            <input
                                type="text"
                                className="flex-grow bg-gray-700 border border-gray-600 rounded-full px-4 py-2 text-gray-100 text-sm focus:outline-none focus:ring-2 focus:ring-green-500 placeholder-gray-400"
                                value={commandInput}
                                onChange={(e) => setCommandInput(e.target.value)}
                                placeholder={isAskingAI ? "AI is thinking..." : "Type your message..."}
                                autoFocus
                                disabled={isAskingAI} // Disable input while AI is thinking
                            />
                            <button
                                type="submit"
                                className="ml-2 bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-full text-sm transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:ring-offset-gray-800"
                                disabled={isAskingAI}
                            >
                                Send
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        // Render the React App into the root div
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
